monitors:
  - name: "namespace-cost-monitoring-overall"
    type: "metric alert"
    query: "avg(last_1d):sum:kubernetes.cost.by_namespace{kubernetes.io/cluster/xquare-v3-cluster:owned} by {namespace} > 100"
    message: |
      ë„¤ì„ìŠ¤í˜ì´ìŠ¤ {{namespace.name}}ì˜ ì¼ì¼ ë¹„ìš©ì´ 100 ë‹¬ëŸ¬ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.
      
      @slack-XQUARE-alerts-cost
    tags:
      - "service:cost-monitoring"
      - "env:production"
    options:
      thresholds:
        critical: 100
        warning: 80
      notify_no_data: false
      require_full_window: false
      include_tags: true
      evaluation_delay: 900

  - name: node-cpu-high
    namespace: monitoring
    type: metric alert
    query: >
      avg(last_5m):avg:aws.ec2.cpuutilization{*} by {kube_node} >= 80
    message: >
      ğŸš¨ *High Node CPU Alert*
      The average CPU utilization on one or more nodes is over 80% in the last 5 minutes.
      @slack-XQUARE-alerts-infra
    tags:
      - "env:production"
    priority: 3
    options:
      evaluationDelay: 0
      includeTags: true
      locked: false
      notifyNoData: false
      noDataTimeframe: 10
      thresholds:
        critical: "80"
        warning: "70"

  - name: "pod-cpu-overprovisioned"
    namespace: monitoring
    type: "metric alert"
    query: >
      avg:kubernetes.cpu.usage.total{*} by {pod_name} / avg:kubernetes.cpu.requests{*} by {pod_name} * 100 < 40
    message: >
      ğŸš¨ *Pod CPU ê³¼í• ë‹¹ ê°ì§€*
      Pod {{pod_name.name}} ì˜ CPU ì‚¬ìš©ë¥ ì´ ìš”ì²­ ëŒ€ë¹„ 40% ë¯¸ë§Œì…ë‹ˆë‹¤.
      ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ìš”ì²­ëŸ‰ ì¡°ì •ì„ ê³ ë ¤í•´ì£¼ì„¸ìš”.
      @slack-XQUARE-alerts-infra
    tags:
      - "env:production"
      - "resource:cpu"
    priority: 2
    options:
      thresholds:
        critical: "0.4"
        warning: "0.5"
      notifyNoData: false
      requireFullWindow: false
      includeTags: true
